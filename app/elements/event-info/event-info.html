<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">

<polymer-element name="event-info" attributes="userID eventID">
    <template>
        <link rel="stylesheet" href="event-info.css">

        <core-ajax id="ajax-user" auto with-credentials="true" url="{{userUrl}}" response="{{userResponse}}" handleAs="json"></core-ajax>
        <core-ajax id="ajax-event" auto with-credentials="true" url="{{eventUrl}}" response="{{eventResponse}}" handleAs="json"></core-ajax>

        <div id="event-page">
            <div class="user-header">
                <div class="user-name">{{user.firstName}} {{user.lastName}}
                    <div class="event-post-date">posted on {{eventDate}}</div>
                </div>
            </div>
            <div class="event-info">
                <div class="event-title">{{event.title}}</div>
                <div class="event-text">{{event.description}}</div>
            </div>
            <div class="raise-a-question">Raise a question</div>
            <div class="your-question">
                <core-input class="question-input" multiline rows="fit" placeholder="Your question here..." value="{{questionText}}"></core-input>
            </div>
            <div class="create-new-container">
                <paper-button class="action-button" id="new-event-button" on-click="{{submitQuestion}}">
                    Submit
                </paper-button>
            </div>
        </div>
    </template>
    <script>
    Polymer('event-info', {
        // initialize the element's model
        ready: function() {
            // this.ajaxUser = document.querySelector('#ajax-user');
            // this.ajaxUser.addEventListener('core-response', function(e) {
            //     this.user = e.detail.response.user;
            // });
            // this.ajaxEvent = document.querySelector('#ajax-event');
            // this.ajaxEvent.addEventListener('core-response', function(e) {
            //     this.event = e.detail.response.event;
            // });

        },
        userUrl: '',
        eventUrl: '',
        userResponseChanged: function() {
            this.user = this.userResponse;
        },
        eventResponseChanged: function() {
            this.event = this.eventResponse;
            this.eventDate = new Date(+this.event.eventDate);
        },
        build: function(userID, eventID) {
            if(userID && eventID) {
                this.userUrl = 'http://ec2-54-69-236-51.us-west-2.compute.amazonaws.com/www/api/users/' + userID;
                this.eventUrl = 'http://ec2-54-69-236-51.us-west-2.compute.amazonaws.com/www/api/events/' + eventID;
            }
        },
        questionText: '',
        submitQuestion: function() {
            if (this.questionText.length > 0) {
                console.log('submitting question: ' + this.questionText);
            }
        },
        updateModel: function(model) {
            this.user = model.user;
            this.event = model.event;
        }
    });
    </script>
</polymer-element>